this.BX=this.BX||{},this.BX.Polus=this.BX.Polus||{},this.BX.Polus.Vue=this.BX.Polus.Vue||{},function(a,b){'use strict';var c={render:function(){var a=this,b=a.$createElement,c=a._self._c||b;return c("div",{staticClass:"parts-container"},[c("div",{staticClass:"container-image"},[c("div",{staticClass:"container-image__block"},[a.picture.src?c("img",{attrs:{src:a.picture.src},on:{click:a.setPoint}}):c("input",{directives:[{name:"model",rawName:"v-model",value:a.file,expression:"file"}],attrs:{type:"file",id:"spare-part-picture",name:"file",accept:"image/*"},domProps:{value:a.file},on:{change:a.sendFile,input:function(b){b.target.composing||(a.file=b.target.value)}}}),a._v(" "),a.picture.src?c("input",{staticClass:"picture-remove",attrs:{type:"submit",value:"x"},on:{click:function(b){return b.preventDefault(),a.removeFile.apply(null,arguments)}}}):a._e()]),a._v(" "),a._l(a.points,function(b){return c("div",{key:b.id,staticClass:"container-point",style:a.getStyle(b.x,b.y),domProps:{innerHTML:a._s(b.id)}})})],2),a._v(" "),a.picture.src&&0<a.points.length?c("div",{staticClass:"parts-container__points"},[c("table",[c("thead",[c("th",{domProps:{innerHTML:a._s(a.loc.POLUS_VUE_SPARE_PART_TABLE_HEADER_INDEX)}}),a._v(" "),c("th",{domProps:{innerHTML:a._s(a.loc.POLUS_VUE_SPARE_PART_TABLE_HEADER_ELEMENT)}}),a._v(" "),c("th",{domProps:{innerHTML:a._s(a.loc.POLUS_VUE_SPARE_PART_TABLE_HEADER_X)}}),a._v(" "),c("th",{domProps:{innerHTML:a._s(a.loc.POLUS_VUE_SPARE_PART_TABLE_HEADER_Y)}}),a._v(" "),c("th"),a._v(" "),c("th")]),a._v(" "),c("tbody",a._l(a.points,function(b){return c("point",{key:"spare-part-"+b.id,attrs:{id:b.id,"iblock-id":a.sparePartsIblockId,coords:{x:b.x,y:b.y},"allow-value":b.value,error:b.error,"allow-indexes":a.indexes},on:{changeId:a.setPointId,remove:a.removePoint}})}),1)]),a._v(" "),c("input",{attrs:{type:"submit"},on:{click:function(b){return b.preventDefault(),a.sendForm.apply(null,arguments)}}})]):a._e()])},staticRenderFns:[],name:"parts",data:function(){return{points:this.savedPoints,indexes:[],lastId:0,file:null,fileUrl:"polus:spareparts.spartfile.",partsUrl:"polus:spareparts.iblock."}},props:{picture:{type:Object,default:function(){return{src:"",id:0}}},savedPoints:{type:Array,default:[]},productIblockId:{type:Number,default:0},sparePartsIblockId:{type:Number,default:0},elementId:{type:Number,default:0},rewriteIfRemove:{type:Boolean,default:!0}},mounted:function(){for(var a in this.points)this.indexes.push(this.points[a].id),parseInt(this.lastId)<parseInt(this.points[a].id)&&(this.lastId=parseInt(this.points[a].id))},computed:{loc:function(){return b.Vue.getFilteredPhrases("POLUS_VUE_")}},methods:{setPoint:function(a){var b=a.offsetX-10,c=a.offsetY-10;for(var d in this.points)""===this.points[d].value.trim()&&this.$set(this.points[d],"value",this.getSparePartInputValue(this.points[d].id));this.indexes.push(++this.lastId),this.points.push({id:this.lastId,x:b,y:c,value:"",error:!1})},getStyle:function(a,b){return"left:"+a+"px;top:"+b+"px;"},getValue:function(a){var b=this.points.find(function(b){return b.id===a});return b&&b.hasOwnProperty("value")?b.value:""},setPointId:function(a){if(a.hasOwnProperty("oldId")){var b=this.points.findIndex(function(b){return b.id===a.oldId}),c=this.points.findIndex(function(b){return b.id===a.id});if(-1===c&&-1!==b){var d=this.indexes.findIndex(function(b){return b===a.oldId});-1!==d&&this.$set(this.indexes,d,b),delete a.oldId,a.x=this.points[b].x,a.y=this.points[b].y,a.value=this.points[b].value,this.$set(this.points,b,a)}}},removePoint:function(a){var b=this.points.findIndex(function(b){return b.id===a});if(this.points.splice(b,1),this.rewriteIfRemove)for(var c in this.points)""===this.points[c].value.trim()&&this.$set(this.points[c],"value",this.getSparePartInputValue(this.points[c].id)),this.lastId=this.points[c].id=parseInt(c)+1},sendFile:function(){var a=this,b=new FormData,c=document.getElementById("spare-part-picture").files[0];c&&(b.append("file",c),b.append("iblockId",this.productIblockId.toString()),b.append("elementId",this.elementId.toString()),this.$request.setUrl(this.fileUrl+"saveFile").setData(b).send().then(function(b){var c=b.src,d=b.id;c&&d&&(a.$set(a.picture,"src",b.src),a.$set(a.picture,"id",b.id))}))},removeFile:function(){this.$confirm.setOkButtonName(this.loc.POLUS_VUE_REMOVE_BUTTON_OK).setTitle(this.loc.POLUS_VUE_REMOVE_SPARE_PARTS_TITLE).open(this.loc.POLUS_VUE_REMOVE_SPARE_PARTS_CONFIRM,{onSuccess:this.removeFileSuccess,onCancel:this.removeFileCancel})},removeFileSuccess:function(){var a=this,b=new FormData;b.append("fileId",this.picture.id),this.$request.setUrl(this.fileUrl+"removeFile").setData(b).send().then(function(b){!0===b&&(a.file=null,a.$set(a.picture,"src",""),a.$set(a.picture,"id",0),a.points.splice(0),a.lastId=0,a.showSuccessMessage(a.loc.POLUS_VUE_FILE_SPARE_PART_REMOVE_SUCCESS))})},removeFileCancel:function(){return!1},sendForm:function(){var a=this;if(this.saveSparePartsToArray(),!this.isValid())return!1;var b=new FormData,c={};for(var d in this.points)c[this.points[d].id]=this.points[d];var e={items:JSON.stringify(c),iblock_id:this.sparePartsIblockId,element_id:this.elementId,file:this.picture.src};b.append("parameters",JSON.stringify(e)),this.$request.setUrl(this.partsUrl+"saveSparePart").setData(b).send().then(function(b){!0===b?a.showSuccessMessage(a.loc.POLUS_VUE_SAVE_SUCCESS):a.showErrorMessage(a.loc.POLUS_VUE_SAVE_ERROR)}).catch(function(b){console.error(b),a.showErrorMessage(a.loc.POLUS_VUE_SAVE_ERROR)})},isValid:function(){for(var a in this.points){if(""===this.points[a].value.trim())return this.showErrorMessage(this.loc.POLUS_VUE_SEND_VALID_ERROR),this.points[a].error=!0,!1;this.points[a].error=!1}return!0},saveSparePartsToArray:function(){for(var a in this.points){var b=this.getSparePartInputValue(this.points[a].id);this.$set(this.points[a],"value",b)}},getSparePartInputValue:function(a){return document.getElementById("PROP[SPARE_PART][n"+a+"]").value},showSuccessMessage:function(a){this.$notification.setSuccess().open(a)},showErrorMessage:function(a){this.$notification.setError().open(a)}}},d={render:function(){var a=this,b=a.$createElement,c=a._self._c||b;return c("tr",{staticClass:"element-point"},[c("td",[c("input",{directives:[{name:"model",rawName:"v-model",value:a.elementId,expression:"elementId"}],class:{error:!a.elementId},attrs:{size:"3",type:"text",name:"'index'"},domProps:{value:a.elementId},on:{change:a.changeId,input:function(b){b.target.composing||(a.elementId=b.target.value)}}})]),a._v(" "),c("td",[c("input",{directives:[{name:"model",rawName:"v-model",value:a.value,expression:"value"}],ref:"point",class:{error:!a.value},attrs:{name:"PROP[SPARE_PART][n"+a.id+"]",id:"PROP[SPARE_PART][n"+a.id+"]",size:"3",type:"text",readonly:""},domProps:{value:a.value},on:{input:function(b){b.target.composing||(a.value=b.target.value)}}})]),a._v(" "),c("td",[c("input",{directives:[{name:"model",rawName:"v-model",value:a.coords.x,expression:"coords.x"}],attrs:{size:"3",type:"text",name:"'coords-x'",readonly:""},domProps:{value:a.coords.x},on:{input:function(b){b.target.composing||a.$set(a.coords,"x",b.target.value)}}})]),a._v(" "),c("td",[c("input",{directives:[{name:"model",rawName:"v-model",value:a.coords.y,expression:"coords.y"}],attrs:{size:"3",type:"text",name:"'coords-y'",readonly:""},domProps:{value:a.coords.y},on:{input:function(b){b.target.composing||a.$set(a.coords,"y",b.target.value)}}})]),a._v(" "),c("td",[c("input",{attrs:{type:"button",value:"..."},on:{click:function(b){return b.preventDefault(),a.addElement.apply(null,arguments)}}})]),a._v(" "),c("td",[c("input",{attrs:{type:"button",value:"x"},on:{click:function(b){return b.preventDefault(),a.removeElement.apply(null,arguments)}}})])])},staticRenderFns:[],name:"point",data:function(){return{active:!1,value:this.allowValue,elementId:this.id}},props:{id:{type:[Number,String],default:0},iblockId:{type:Number,default:0},allowValue:{type:[Number,String],default:""},allowIndexes:{type:Array,default:[]},error:{type:Boolean,default:!1},coords:{type:Object,default:function(){return{x:"",y:""}}}},watch:{allowValue:function(a){this.value=a},id:function(a){this.elementId=a}},methods:{changeId:function(){var a=this;if(!this.elementId.match(/^\d+$/))return void(this.elementId=this.id);var b=this.allowIndexes.findIndex(function(b){return b===a.elementId});-1===b?this.$emit("changeId",{id:this.elementId,oldId:this.id}):this.elementId=this.id},addElement:function(){jsUtils.OpenWindow("/bitrix/admin/iblock_element_search.php?lang=ru&IBLOCK_ID="+this.iblockId+"&n=PROP[SPARE_PART]&k=n"+this.id+"&iblockfix=y",900,700)},removeElement:function(){this.$emit("remove",this.id)},getElement:function(){var a=document.getElementById("PROP[SPARE_PART][n"+this.id+"]");return{id:this.elementId,x:this.coords.x,y:this.coords.y,value:a.value}},setActive:function(a){this.active=a}}};b.Vue.component("Point",d),b.Vue.component("Parts",c)}(this.BX.Polus.Vue.Parts=this.BX.Polus.Vue.Parts||{},BX);
//# sourceMappingURL=main.bundle.js.map
